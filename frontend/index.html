<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scene Understanding Platform</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <!-- ===== Header ===== -->
  <header class="header">
    <div class="header-inner">
      <h1 class="logo">ğŸ§  Scene Understanding Platform</h1>
      <div class="header-status">
        <span id="device-badge" class="badge badge-neutral">Device: â€¦</span>
        <span id="model-badge" class="badge badge-neutral">Model: â€¦</span>
        <span id="depth-badge" class="badge badge-neutral">Depth: off</span>
        <span id="tracking-badge" class="badge badge-gpu">Tracking: on</span>
      </div>
    </div>
  </header>

  <!-- ===== Main layout ===== -->
  <main class="container">

    <!-- ===== Tabs ===== -->
    <nav class="tabs" role="tablist">
      <button class="tab-btn active" data-tab="video" role="tab">ğŸ“ Video Upload</button>
      <button class="tab-btn"        data-tab="camera" role="tab">ğŸ“· Live Camera</button>
      <button class="tab-btn"        data-tab="analytics" role="tab">ğŸ“Š Analytics</button>
      <button class="tab-btn"        data-tab="multicam" role="tab">ğŸ¥ Multi-Camera</button>
    </nav>

    <!-- ========================================================== -->
    <!--  VIDEO TAB                                                  -->
    <!-- ========================================================== -->
    <section id="tab-video" class="tab-panel active" role="tabpanel">

      <div class="card upload-card">
        <h2>Upload Video</h2>
        <p class="hint">Accepted formats: .mp4 &nbsp;Â·&nbsp; .avi &nbsp;Â·&nbsp; .mov &nbsp;Â·&nbsp; .mkv &nbsp;&nbsp;|&nbsp;&nbsp; Max 500 MB</p>

        <!-- Drop-zone -->
        <div id="drop-zone" class="drop-zone" tabindex="0" role="button"
             aria-label="Click or drag a video file here">
          <span id="drop-label">ğŸ¬ Drag &amp; drop a video here, or click to browse</span>
          <input type="file" id="file-input" accept=".mp4,.avi,.mov,.mkv" hidden />
        </div>

        <!-- Selected file info -->
        <div id="file-info" class="file-info hidden">
          <span id="file-name"></span>
          <span id="file-size"></span>
        </div>

        <!-- Upload + process button -->
        <button id="upload-btn" class="btn btn-primary" disabled>
          â¬† Upload &amp; Process
        </button>

        <!-- Upload progress bar -->
        <div id="upload-progress-wrap" class="progress-wrap hidden">
          <label>Uploadingâ€¦</label>
          <div class="progress-bar-bg">
            <div id="upload-progress-bar" class="progress-bar" style="width:0%"></div>
          </div>
          <span id="upload-progress-pct">0%</span>
        </div>

        <!-- Processing progress bar -->
        <div id="process-progress-wrap" class="progress-wrap hidden">
          <label>Processing framesâ€¦</label>
          <div class="progress-bar-bg">
            <div id="process-progress-bar" class="progress-bar" style="width:0%"></div>
          </div>
          <span id="process-progress-pct">0 / 0</span>
          <span id="process-fps" class="fps-badge">0 fps</span>
        </div>

        <!-- Status message -->
        <p id="video-status" class="status-msg"></p>
      </div>

      <!-- Output video player -->
      <div id="output-card" class="card output-card hidden">
        <h2>Segmented Output</h2>
        <video id="output-video" controls playsinline></video>
        <div class="output-actions">
          <a id="download-link" class="btn btn-secondary" download>â¬‡ Download</a>
        </div>
      </div>

    </section>

    <!-- ========================================================== -->
    <!--  CAMERA TAB                                                 -->
    <!-- ========================================================== -->
    <section id="tab-camera" class="tab-panel" role="tabpanel">

      <div class="card camera-card">
        <h2>Live Camera Feed</h2>

        <div class="camera-controls">
          <button id="start-cam-btn" class="btn btn-primary">â–¶ Start Camera</button>
          <button id="stop-cam-btn"  class="btn btn-danger"  disabled>â–  Stop Camera</button>
          <button id="heatmap-btn"   class="btn btn-secondary">ğŸ”¥ Heatmap</button>
          <button id="depth-btn"     class="btn btn-secondary">ğŸ”­ Depth</button>
          <div class="fps-display">
            <span class="fps-label">FPS</span>
            <span id="cam-fps" class="fps-value">â€”</span>
          </div>
        </div>

        <!-- Mask transparency slider -->
        <div class="slider-row">
          <label for="alpha-slider">Mask opacity</label>
          <input type="range" id="alpha-slider" min="0" max="100" value="45" />
          <span id="alpha-value">45%</span>
        </div>

        <!-- Live stats panel -->
        <div id="cam-stats" class="stats-panel hidden">
          <div class="stat-item"><span class="stat-label">Objects</span><span id="cam-obj-count" class="stat-value">0</span></div>
          <div class="stat-item"><span class="stat-label">Persons</span><span id="cam-person-count" class="stat-value">0</span></div>
          <div class="stat-item"><span class="stat-label">Vehicles</span><span id="cam-vehicle-count" class="stat-value">0</span></div>
        </div>

        <!-- MJPEG stream image -->
        <div class="stream-container">
          <img id="cam-stream"
               src=""
               alt="Camera feed (click Start Camera)"
               class="stream-img" />
          <div id="cam-overlay" class="cam-overlay">
            <span>ğŸ“· Camera not started</span>
          </div>
        </div>

        <p id="camera-status" class="status-msg"></p>
      </div>

    </section>

    <!-- ========================================================== -->
    <!--  ANALYTICS TAB                                              -->
    <!-- ========================================================== -->
    <section id="tab-analytics" class="tab-panel" role="tabpanel">

      <div class="card">
        <h2>ğŸ“Š Live Analytics</h2>
        <div class="analytics-grid">
          <div class="stat-card">
            <div class="stat-card-label">Total Objects</div>
            <div id="analytics-total" class="stat-card-value">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-label">Current FPS</div>
            <div id="analytics-fps" class="stat-card-value">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-label">Frames Processed</div>
            <div id="analytics-frames" class="stat-card-value">0</div>
          </div>
        </div>

        <h3 style="margin-top:1.5rem;">Object Counts by Class</h3>
        <div id="analytics-counts" class="counts-list">
          <p class="hint">Start a camera feed to see live counts</p>
        </div>

        <h3 style="margin-top:1.5rem;">Recent Events</h3>
        <div id="analytics-events" class="events-list">
          <p class="hint">No events yet</p>
        </div>

        <div style="margin-top:1.5rem;">
          <a href="/api/analytics/export" class="btn btn-secondary" download="events.csv">ğŸ“¥ Export CSV</a>
        </div>
      </div>

      <!-- Benchmark -->
      <div class="card">
        <h2>âš¡ Performance Benchmark</h2>
        <div class="analytics-grid">
          <div class="stat-card">
            <div class="stat-card-label">Avg FPS</div>
            <div id="bench-fps" class="stat-card-value">â€”</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-label">GPU Memory</div>
            <div id="bench-gpu-mem" class="stat-card-value">â€”</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-label">CPU Load</div>
            <div id="bench-cpu" class="stat-card-value">â€”</div>
          </div>
        </div>
        <button id="refresh-bench-btn" class="btn btn-secondary" style="margin-top:1rem;">ğŸ”„ Refresh</button>
      </div>

    </section>

    <!-- ========================================================== -->
    <!--  MULTI-CAMERA TAB                                           -->
    <!-- ========================================================== -->
    <section id="tab-multicam" class="tab-panel" role="tabpanel">

      <div class="card">
        <h2>ğŸ¥ Multi-Camera Manager</h2>
        <div class="multicam-controls">
          <input type="number" id="mc-cam-index" class="input-field" value="0" min="0" placeholder="Camera index" />
          <input type="text" id="mc-cam-label" class="input-field" placeholder="Label (optional)" />
          <button id="mc-start-btn" class="btn btn-primary">+ Add Camera</button>
        </div>

        <div id="mc-streams-list" class="streams-list">
          <p class="hint">No active camera streams</p>
        </div>
      </div>

    </section>

  </main>

  <!-- ===== Footer ===== -->
  <footer class="footer">
    <p>Real-Time Intelligent Scene Understanding Platform &nbsp;Â·&nbsp; Powered by YOLOv8-seg &amp; FastAPI</p>
  </footer>

  <script src="/static/script.js"></script>
</body>
</html>
