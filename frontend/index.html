<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panoptic Segmentation</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <!-- ===== Header ===== -->
  <header class="header">
    <div class="header-inner">
      <h1 class="logo">üî¨ Panoptic Segmentation</h1>
      <div class="header-status">
        <span id="device-badge" class="badge badge-neutral">Device: ‚Ä¶</span>
        <span id="model-badge" class="badge badge-neutral">Model: ‚Ä¶</span>
      </div>
    </div>
  </header>

  <!-- ===== Main layout ===== -->
  <main class="container">

    <!-- ===== Tabs ===== -->
    <nav class="tabs" role="tablist">
      <button class="tab-btn active" data-tab="video" role="tab">üìÅ Video Upload</button>
      <button class="tab-btn"        data-tab="camera" role="tab">üì∑ Live Camera</button>
    </nav>

    <!-- ========================================================== -->
    <!--  VIDEO TAB                                                  -->
    <!-- ========================================================== -->
    <section id="tab-video" class="tab-panel active" role="tabpanel">

      <div class="card upload-card">
        <h2>Upload Video</h2>
        <p class="hint">Accepted formats: .mp4 &nbsp;¬∑&nbsp; .avi &nbsp;¬∑&nbsp; .mov &nbsp;¬∑&nbsp; .mkv &nbsp;&nbsp;|&nbsp;&nbsp; Max 500 MB</p>

        <!-- Drop-zone -->
        <div id="drop-zone" class="drop-zone" tabindex="0" role="button"
             aria-label="Click or drag a video file here">
          <span id="drop-label">üé¨ Drag &amp; drop a video here, or click to browse</span>
          <input type="file" id="file-input" accept=".mp4,.avi,.mov,.mkv" hidden />
        </div>

        <!-- Selected file info -->
        <div id="file-info" class="file-info hidden">
          <span id="file-name"></span>
          <span id="file-size"></span>
        </div>

        <!-- Upload + process button -->
        <button id="upload-btn" class="btn btn-primary" disabled>
          ‚¨Ü Upload &amp; Process
        </button>

        <!-- Upload progress bar -->
        <div id="upload-progress-wrap" class="progress-wrap hidden">
          <label>Uploading‚Ä¶</label>
          <div class="progress-bar-bg">
            <div id="upload-progress-bar" class="progress-bar" style="width:0%"></div>
          </div>
          <span id="upload-progress-pct">0%</span>
        </div>

        <!-- Processing progress bar -->
        <div id="process-progress-wrap" class="progress-wrap hidden">
          <label>Processing frames‚Ä¶</label>
          <div class="progress-bar-bg">
            <div id="process-progress-bar" class="progress-bar" style="width:0%"></div>
          </div>
          <span id="process-progress-pct">0 / 0</span>
          <span id="process-fps" class="fps-badge">0 fps</span>
        </div>

        <!-- Status message -->
        <p id="video-status" class="status-msg"></p>
      </div>

      <!-- Output video player -->
      <div id="output-card" class="card output-card hidden">
        <h2>Segmented Output</h2>
        <video id="output-video" controls playsinline></video>
        <div class="output-actions">
          <a id="download-link" class="btn btn-secondary" download>‚¨á Download</a>
        </div>
      </div>

    </section>

    <!-- ========================================================== -->
    <!--  CAMERA TAB                                                 -->
    <!-- ========================================================== -->
    <section id="tab-camera" class="tab-panel" role="tabpanel">

      <div class="card camera-card">
        <h2>Live Camera Feed</h2>

        <div class="camera-controls">
          <button id="start-cam-btn" class="btn btn-primary">‚ñ∂ Start Camera</button>
          <button id="stop-cam-btn"  class="btn btn-danger"  disabled>‚ñ† Stop Camera</button>
          <div class="fps-display">
            <span class="fps-label">FPS</span>
            <span id="cam-fps" class="fps-value">‚Äî</span>
          </div>
        </div>

        <!-- Mask transparency slider -->
        <div class="slider-row">
          <label for="alpha-slider">Mask opacity</label>
          <input type="range" id="alpha-slider" min="0" max="100" value="45" />
          <span id="alpha-value">45%</span>
        </div>

        <!-- MJPEG stream image -->
        <div class="stream-container">
          <img id="cam-stream"
               src=""
               alt="Camera feed (click Start Camera)"
               class="stream-img" />
          <div id="cam-overlay" class="cam-overlay">
            <span>üì∑ Camera not started</span>
          </div>
        </div>

        <p id="camera-status" class="status-msg"></p>
      </div>

    </section>

  </main>

  <!-- ===== Footer ===== -->
  <footer class="footer">
    <p>Panoptic Segmentation App &nbsp;¬∑&nbsp; Powered by YOLOv8-seg &amp; FastAPI</p>
  </footer>

  <script src="/static/script.js"></script>
</body>
</html>
